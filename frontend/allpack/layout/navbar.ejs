<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
  <div class="container">

    <!-- Brand -->
    <a class="navbar-brand" href="#">
      <i class="fas fa-heart me-2"></i>Dream Day
    </a>

    <!-- Hamburger (mobile only) -->
    <button class="navbar-toggler custom-toggler d-lg-none" type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation">
      <div class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>

    <!-- COLLAPSIBLE MENU -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link <%= activePage === 'home' ? 'active' : '' %>" href="/home">
            <i class="fas fa-home me-1"></i> Home
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= activePage === 'about' ? 'active' : '' %>" href="/about">
            <i class="fas fa-info-circle me-1"></i> About
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= activePage === 'services' ? 'active' : '' %>" href="/services">
            <i class="fas fa-gift me-1"></i> Services
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= activePage === 'suppliers' ? 'active' : '' %>" href="/suppliers">
            <i class="fas fa-camera me-1"></i> Suppliers
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= activePage === 'booking' ? 'active' : '' %>" href="/booking">
            <i class="fas fa-bookmark me-1"></i> Book Consultation
          </a>
        </li>
      </ul>
    </div>

    <!-- CLOSE BUTTON (mobile only) -->
    <button class="navbar-close-btn d-lg-none"
        type="button"
        aria-label="Close">
        <i class="fas fa-times"></i>
    </button>

  </div>
</nav>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var navbarCollapse = document.getElementById('navbarNav');
    var body = document.body;
    var navLinks = document.querySelectorAll('.nav-link');
    var closeBtn = document.querySelector('.navbar-close-btn');
    var hamburgerBtn = document.querySelector('.navbar-toggler');
    var navbar = document.querySelector('.navbar');

    // Initialize Bootstrap Collapse
    var bsCollapse = new bootstrap.Collapse(navbarCollapse, {
        toggle: false
    });

    // Function to handle menu state
    function handleMenuState(isOpening) {
        if (window.innerWidth < 992) { // Mobile only
            if (isOpening) {
                body.classList.add('menu-open');
                if (closeBtn) {
                    closeBtn.classList.add('mobile-visible');
                    closeBtn.style.display = 'block';
                }
                if (hamburgerBtn) {
                    hamburgerBtn.style.display = 'none';
                }
            } else {
                body.classList.remove('menu-open');
                if (closeBtn) {
                    closeBtn.classList.remove('mobile-visible');
                    closeBtn.style.display = 'none';
                }
                if (hamburgerBtn) {
                    hamburgerBtn.style.display = 'block';
                }
            }
        }
    }

    // Add event listeners for menu state
    navbarCollapse.addEventListener('show.bs.collapse', function () {
        handleMenuState(true);
    });

    navbarCollapse.addEventListener('hide.bs.collapse', function () {
        handleMenuState(false);
        
        // Reset animations
        navbarCollapse.querySelectorAll('.nav-item').forEach(function(item) {
            item.style.opacity = '1';
            item.style.animation = 'none';
        });
    });

    // Close menu on nav-link click (mobile only)
    navLinks.forEach(function(link) {
        link.addEventListener('click', function() {
            if (window.innerWidth < 992) {
                bsCollapse.hide();
            }
        });
    });

    // Close menu on close button click
    if(closeBtn) {
        closeBtn.addEventListener('click', function() {
            bsCollapse.hide();
        });
        
        // Initially hide the close button
        closeBtn.style.display = 'none';
    }

    // Close menu when clicking outside (only on mobile)
    document.addEventListener('click', function(event) {
        if (window.innerWidth < 992 && navbarCollapse.classList.contains('show')) {
            var isClickInsideNavbar = navbar.contains(event.target);
            var isClickOnHamburger = hamburgerBtn && hamburgerBtn.contains(event.target);
            var isClickOnCloseBtn = closeBtn && closeBtn.contains(event.target);
            
            if (!isClickInsideNavbar && !isClickOnHamburger && !isClickOnCloseBtn) {
                bsCollapse.hide();
            }
        }
    });

    // Handle resize - ensure proper button states
    function handleResize() {
        if (window.innerWidth >= 992) {
            // Desktop: ensure menu is closed, hide mobile buttons
            body.classList.remove('menu-open');
            if (closeBtn) {
                closeBtn.classList.remove('mobile-visible');
                closeBtn.style.display = 'none';
            }
            if (hamburgerBtn) {
                hamburgerBtn.style.display = 'none';
            }
            // Ensure menu is expanded on desktop
            if (!navbarCollapse.classList.contains('show')) {
                bsCollapse.show();
            }
        } else {
            // Mobile: show hamburger, manage close button based on menu state
            if (hamburgerBtn) {
                hamburgerBtn.style.display = 'block';
            }
            if (navbarCollapse.classList.contains('show')) {
                if (closeBtn) {
                    closeBtn.classList.add('mobile-visible');
                    closeBtn.style.display = 'block';
                }
                if (hamburgerBtn) {
                    hamburgerBtn.style.display = 'none';
                }
            } else {
                if (closeBtn) {
                    closeBtn.classList.remove('mobile-visible');
                    closeBtn.style.display = 'none';
                }
            }
        }
    }

    // Add resize listener with debounce
    var resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(handleResize, 100);
    });

    // Initialize on load
    handleResize();
});
</script>